/*! Spai - by:rhapsodyn - v0.1.0 - 2014-01-02 */ 
!function(a){var b=a.Spai||{},c=function(a){return"function"==typeof a},d=function(a){return"object"==typeof a&&null!==a},e={pending:0,fulfilled:1,rejected:2,sealed:3},f=0,g=function(){return"undefined"!=typeof process&&"[object process]"===toString.call(process)?function(a){process.nextTick(a)}:function(a){setTimeout(a,1)}}(),h=function(a,b,d,f){var g;if(a._state===e.fulfilled)if(c(b))try{g=b(a._resolvedValue),j(f,g)}catch(h){l(f,h)}else k(f,a._resolvedValue);else if(a._state===e.rejected)if(c(d))try{g=d(a._rejectedReason),j(f,g)}catch(h){l(f,h)}else l(f,a._rejectedReason)},i=function(a,b){b&&(a._state=b);for(var c=0,d=a._thenQueue;c<d.length;c++){var f=d[c],g=f[e.fulfilled],j=f[e.rejected],k=f[3];h(a,g,j,k),i(k)}},j=function(a,b){var e=!1;if(b===a)l(a,new TypeError("thenable can not return the same promise"));else if(c(b)||d(b))try{var f=b.then;c(f)?f.call(b,function(c){e||(e=!0,b!==c?j(a,c):k(a,c))},function(b){e||(e=!0,l(a,b))}):k(a,b)}catch(g){if(e)return;l(a,g)}else k(a,b)},k=function(a,b){a._state===e.pending&&(a._state=e.sealed,a._resolvedValue=b,g(function(){i(a,e.fulfilled)}))},l=function(a,b){a._state===e.pending&&(a._state=e.sealed,a._rejectedReason=b,g(function(){i(a,e.rejected)}))},m=function(){var a={_thenQueue:[],_state:e.pending,_id:++f};return a.then=function(b,c){var d=m();return a._state===e.fulfilled||a._state===e.rejected?g(function(){h(a,b,c,d)}):a._thenQueue.push([0,b,c,d]),d},a};b.promise=function(a){var b=m(),d=function(a){j(b,a)},e=function(a){l(b,a)};return c(a)&&a.call(this,d,e),b},b.defer=function(){var a={};return a.promise=b.promise(function(b,c){a.resolve=b,a.reject=c}),a},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b:a.Spai=b}(this);